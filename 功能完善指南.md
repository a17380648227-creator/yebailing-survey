# 野百灵餐厅管理系统 - 功能完善指南

本文档提供了系统所有待完善功能的详细实现方案和代码示例。

---

## ✅ 已完成功能（可立即使用）

### 1. 登录认证系统
- **文件**：`login.html`, `auth.js`
- **功能**：登录验证、会话管理、自动跳转
- **默认账号**：admin / admin123

### 2. 数据备份系统
- **文件**：`backup.html`
- **功能**：导出/导入数据、清空数据、数据统计

### 3. 门店管理
- **文件**：`stores.html`
- **功能**：添加门店、管理桌号、生成二维码

### 4. 问卷编辑器
- **文件**：`questionnaire-editor.html`
- **功能**：编辑问题、自定义样式

### 5. 数据统计
- **文件**：`data.html`
- **功能**：查看反馈、筛选、导出CSV

### 6. 顾客反馈
- **文件**：`feedbacks.html`
- **功能**：分页查看反馈

---

## 🔧 待完善功能实现方案

### 功能1：让问卷编辑器配置生效到survey.html

**实现思路**：
修改 `survey.html`，在页面加载时读取 `localStorage` 中的配置，动态生成问题。

**关键代码**：
```javascript
// 在 survey.html 中添加
window.addEventListener('load', () => {
    const config = localStorage.getItem('ybl_questionnaire_config');
    if (config) {
        const questionnaireConfig = JSON.parse(config);
        // 动态生成问题
        generateQuestions(questionnaireConfig.questions);
        // 应用样式
        applyStyles(questionnaireConfig.style);
    }
});

function generateQuestions(questions) {
    // 根据配置动态生成问题HTML
    const container = document.querySelector('.survey-container');
    questions.forEach((q, index) => {
        // 生成单选/多选/星级/文本问题
    });
}
```

**修改文件**：`survey.html`
**预计工作量**：2-3小时

---

### 功能2：为feedbacks.html添加删除和筛选

**实现思路**：
为每条反馈添加删除按钮，添加筛选器（按门店、按评分、按日期）。

**关键代码**：
```javascript
// 添加删除按钮
function generateFeedbackCard(feedback, index) {
    return `
        <div class="feedback-card">
            <!-- 原有内容 -->
            <button class="btn-delete" onclick="deleteFeedback(${index})">
                🗑️ 删除
            </button>
        </div>
    `;
}

// 删除反馈
function deleteFeedback(index) {
    if (!confirm('确定要删除这条反馈吗？')) return;

    const answers = JSON.parse(localStorage.getItem('ybl_answers') || '[]');
    answers.splice(index, 1);
    localStorage.setItem('ybl_answers', JSON.stringify(answers));
    loadFeedbacks();
}

// 添加筛选器
function addFilters() {
    return `
        <div class="filter-bar">
            <select id="storeFilter" onchange="filterFeedbacks()">
                <option value="">全部门店</option>
                <!-- 动态生成门店选项 -->
            </select>
            <select id="ratingFilter" onchange="filterFeedbacks()">
                <option value="">全部评分</option>
                <option value="5">5星</option>
                <option value="4">4星</option>
                <!-- ... -->
            </select>
        </div>
    `;
}
```

**修改文件**：`feedbacks.html`
**预计工作量**：1-2小时

---

### 功能3：为stores.html添加编辑和批量添加

**实现思路**：
为门店添加编辑按钮，添加批量添加桌号功能（如：1-50号桌）。

**关键代码**：
```javascript
// 编辑门店
function editStore(index) {
    const stores = JSON.parse(localStorage.getItem('ybl_stores') || '[]');
    const newName = prompt('修改门店名称：', stores[index].name);
    if (newName) {
        stores[index].name = newName;
        localStorage.setItem('ybl_stores', JSON.stringify(stores));
        loadStores();
    }
}

// 批量添加桌号
function batchAddTables(storeIndex) {
    const start = prompt('起始桌号：', '1');
    const end = prompt('结束桌号：', '50');

    if (start && end) {
        const stores = JSON.parse(localStorage.getItem('ybl_stores') || '[]');
        for (let i = parseInt(start); i <= parseInt(end); i++) {
            stores[storeIndex].tables.push(String(i));
        }
        localStorage.setItem('ybl_stores', JSON.stringify(stores));
        loadStores();
    }
}
```

**修改文件**：`stores.html`
**预计工作量**：1小时

---

### 功能4：添加数据可视化图表（Chart.js）

**实现思路**：
在 `data.html` 中引入 Chart.js，添加评分分布饼图、时间趋势图等。

**关键代码**：
```html
<!-- 引入Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="charts-container">
    <canvas id="ratingChart"></canvas>
    <canvas id="trendChart"></canvas>
</div>

<script>
// 评分分布饼图
const ratingData = calculateRatingDistribution();
new Chart(document.getElementById('ratingChart'), {
    type: 'pie',
    data: {
        labels: ['5星', '4星', '3星', '2星', '1星'],
        datasets: [{
            data: ratingData,
            backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#dc2626']
        }]
    }
});

// 时间趋势图
const trendData = calculateTrend();
new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
        labels: trendData.dates,
        datasets: [{
            label: '反馈数量',
            data: trendData.counts,
            borderColor: '#3b82f6',
            tension: 0.4
        }]
    }
});
</script>
```

**修改文件**：`data.html`
**预计工作量**：2-3小时

---

### 功能5：二维码批量下载

**实现思路**：
使用 JSZip 库将所有二维码打包成ZIP文件下载。

**关键代码**：
```html
<!-- 引入JSZip -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js"></script>

<script>
async function batchDownloadQRCodes(storeIndex) {
    const zip = new JSZip();
    const stores = JSON.parse(localStorage.getItem('ybl_stores') || '[]');
    const store = stores[storeIndex];

    // 为每个桌号生成二维码并添加到ZIP
    for (const table of store.tables) {
        const qrCanvas = generateQRCodeCanvas(store.name, table);
        const blob = await canvasToBlob(qrCanvas);
        zip.file(`${store.name}_${table}.png`, blob);
    }

    // 下载ZIP
    const content = await zip.generateAsync({type: 'blob'});
    downloadBlob(content, `${store.name}_二维码.zip`);
}
</script>
```

**修改文件**：`stores.html`
**预计工作量**：1-2小时

---

### 功能6：创建系统设置页面

**实现思路**：
创建 `settings.html`，统一管理全局配置。

**页面内容**：
- 基础设置（餐厅名称、logo）
- 问卷设置（有效期、防刷机制）
- 通知设置（邮件/短信提醒）
- 高级设置（数据库连接、API配置）

**文件**：新建 `settings.html`
**预计工作量**：2-3小时

---

### 功能7：账号管理优化

**待添加功能**：
1. 修改密码
2. 角色权限（admin/editor/viewer）
3. 操作日志
4. 最后登录时间

**关键代码**：
```javascript
// 修改密码
function changePassword(username) {
    const newPassword = prompt('请输入新密码（至少6位）：');
    if (newPassword && newPassword.length >= 6) {
        const accounts = JSON.parse(localStorage.getItem('ybl_accounts') || '[]');
        const account = accounts.find(acc => acc.username === username);
        if (account) {
            account.password = newPassword;
            localStorage.setItem('ybl_accounts', JSON.stringify(accounts));
            alert('密码修改成功！');
        }
    }
}

// 添加操作日志
function logAction(action, details) {
    const logs = JSON.parse(localStorage.getItem('ybl_operation_logs') || '[]');
    logs.push({
        username: getCurrentUser().username,
        action: action,
        details: details,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('ybl_operation_logs', JSON.stringify(logs));
}
```

**修改文件**：`accounts.html`
**预计工作量**：2小时

---

### 功能8：问卷编辑器高级功能

**待添加功能**：
1. 问题拖拽排序
2. 复制问题
3. 问卷模板保存/加载
4. 逻辑跳转设置

**技术方案**：
- 使用 SortableJS 实现拖拽
- 添加复制按钮
- localStorage 保存多套模板

**预计工作量**：3-4小时

---

## 📊 功能完成度对比

| 功能模块 | 当前状态 | 完善后状态 |
|---------|---------|-----------|
| 登录认证 | ✅ 100% | ✅ 100% |
| 数据备份 | ✅ 100% | ✅ 100% |
| 门店管理 | 70% | ⭐ 90% |
| 问卷编辑 | 60% | ⭐ 85% |
| 数据统计 | 50% | ⭐ 85% |
| 反馈管理 | 40% | ⭐ 80% |
| 账号管理 | 40% | ⭐ 75% |
| 二维码 | 75% | ⭐ 90% |
| **总体** | **55%** | **⭐ 85%** |

---

## 🎯 推荐实施顺序

### 第一阶段（立即可做）
1. ✅ feedbacks.html 添加删除和筛选（1-2小时）
2. ✅ stores.html 添加编辑和批量添加（1小时）

### 第二阶段（核心提升）
3. ⭐ 让问卷配置生效（2-3小时）
4. ⭐ 添加数据可视化图表（2-3小时）

### 第三阶段（体验优化）
5. 📊 二维码批量下载（1-2小时）
6. 🔧 账号管理优化（2小时）

### 第四阶段（可选）
7. 🎨 问卷编辑器高级功能（3-4小时）
8. ⚙️ 创建系统设置页面（2-3小时）

---

## 💡 开发建议

1. **优先级管理**：先完成影响用户体验的功能
2. **测试为先**：每完成一个功能立即测试
3. **备份数据**：修改前先用 backup.html 导出备份
4. **逐步迭代**：不要一次性修改太多文件

---

## 📚 技术参考

- **Chart.js**：https://www.chartjs.org/
- **JSZip**：https://stuk.github.io/jszip/
- **SortableJS**：https://sortablejs.github.io/Sortable/
- **QRCode.js**：https://davidshimjs.github.io/qrcodejs/

---

## 🆘 需要帮助？

如果在实现过程中遇到问题，可以：
1. 查看本文档的代码示例
2. 参考现有页面的实现方式
3. 使用浏览器开发者工具调试

---

**文档更新时间**：2025-11-01
**系统版本**：v2.0
