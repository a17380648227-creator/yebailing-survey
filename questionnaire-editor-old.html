<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®å·ç¼–è¾‘ - é‡ç™¾çµé¤å…</title>
    <script src="auth.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: white;
        }
        .main-container { max-width: 1400px; margin: 0 auto; padding: 40px 30px; }
        .page-header { margin-bottom: 40px; text-align: center; }
        .page-title {
            font-size: 48px; font-weight: 800;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #ef4444 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; margin-bottom: 12px;
        }
        .page-subtitle { font-size: 16px; color: rgba(255, 255, 255, 0.7); }

        /* æ ‡ç­¾é¡µ */
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        .tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            color: white;
            border-bottom-color: #3b82f6;
        }
        .tab:hover { color: rgba(255, 255, 255, 0.9); }

        /* æ ‡ç­¾é¡µå†…å®¹ */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(147, 197, 253, 0.2);
            margin-bottom: 25px;
        }
        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: white;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* è¡¨å•å…ƒç´  */
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.12);
            border: 2px solid rgba(147, 197, 253, 0.3);
            border-radius: 12px;
            font-size: 14px;
            color: white;
            transition: all 0.3s;
        }
        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.15);
        }
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        .form-select {
            cursor: pointer;
        }
        .form-select option {
            background: #1e293b;
            color: white;
        }

        /* æŒ‰é’® */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }
        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        /* é—®é¢˜åˆ—è¡¨ */
        .question-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .question-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(147, 197, 253, 0.2);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
        }
        .question-item:hover {
            border-color: #3b82f6;
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .question-title-text {
            font-size: 16px;
            font-weight: 600;
            color: white;
            flex: 1;
        }
        .question-type {
            padding: 4px 12px;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            font-size: 12px;
            color: #60a5fa;
            margin-right: 10px;
        }
        .question-actions {
            display: flex;
            gap: 8px;
        }
        .option-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        .option-tag {
            padding: 6px 12px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            font-size: 13px;
            color: #c4b5fd;
        }

        /* å›¾ç‰‡ä¸Šä¼  */
        .image-upload-area {
            border: 2px dashed rgba(147, 197, 253, 0.3);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.05);
        }
        .image-upload-area:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        .image-upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.6;
        }
        .image-preview {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .image-preview-item {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid rgba(147, 197, 253, 0.3);
        }
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* é¢œè‰²é€‰æ‹©å™¨ */
        .color-picker-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .color-input {
            width: 60px;
            height: 40px;
            border: 2px solid rgba(147, 197, 253, 0.3);
            border-radius: 8px;
            cursor: pointer;
        }
        .color-preview {
            flex: 1;
            height: 60px;
            border-radius: 12px;
            border: 2px solid rgba(147, 197, 253, 0.3);
        }

        /* ä¿å­˜æŒ‰é’®ç»„ */
        .save-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }
        .floating-btn {
            padding: 16px 32px;
            font-size: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <script src="navbar.js"></script>
    <script>insertNavbar('questionnaire-editor.html');</script>

    <div class="main-container">
        <div class="page-header">
            <h1 class="page-title">ğŸ“ é—®å·ç¼–è¾‘å™¨</h1>
            <p class="page-subtitle">è‡ªå®šä¹‰é—®å·å†…å®¹ã€æ ·å¼å’Œè½®æ’­å›¾</p>
        </div>

        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('questions')">ğŸ“‹ é—®é¢˜ç®¡ç†</button>
            <button class="tab" onclick="switchTab('images')">ğŸ–¼ï¸ è½®æ’­å›¾ç®¡ç†</button>
            <button class="tab" onclick="switchTab('style')">ğŸ¨ æ ·å¼è®¾ç½®</button>
        </div>

        <!-- æ ‡ç­¾é¡µå†…å®¹ -->

        <!-- é—®é¢˜ç®¡ç† -->
        <div class="tab-content active" id="tab-questions">
            <div class="card">
                <div class="card-title">
                    ğŸ“‹ å½“å‰é—®é¢˜åˆ—è¡¨
                </div>
                <div class="question-list" id="questionList">
                    <!-- é—®é¢˜åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <button class="btn btn-success" onclick="addQuestion()" style="margin-top: 20px;">â• æ·»åŠ æ–°é—®é¢˜</button>
            </div>
        </div>

        <!-- è½®æ’­å›¾ç®¡ç† -->
        <div class="tab-content" id="tab-images">
            <div class="card">
                <div class="card-title">
                    ğŸ–¼ï¸ è½®æ’­å›¾è®¾ç½®
                    <span style="font-size: 14px; font-weight: normal; color: rgba(255,255,255,0.6); margin-left: 10px;">
                        ï¼ˆå»ºè®®å°ºå¯¸ï¼š1080x1920pxï¼Œæ”¯æŒ JPG/PNGï¼‰
                    </span>
                </div>
                <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px; font-size: 14px;">
                    âš ï¸ æ³¨æ„ï¼šç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½éœ€è¦åœ¨å®é™…æœåŠ¡å™¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚æœ¬åœ°é¢„è§ˆæ—¶ï¼Œè¯·ç›´æ¥æ›¿æ¢ pic/ æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡æ–‡ä»¶ã€‚
                </p>
                <div style="color: rgba(255,255,255,0.8); line-height: 1.8; background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 12px;">
                    <strong>ğŸ’¡ å¦‚ä½•æ›´æ¢è½®æ’­å›¾ï¼š</strong><br>
                    1. å‡†å¤‡å¥½3å¼ å›¾ç‰‡ï¼ˆå»ºè®®å°ºå¯¸ 1080x1920pxï¼‰<br>
                    2. é‡å‘½åä¸ºï¼šproduct1.jpgã€product2.jpgã€product3.jpg<br>
                    3. æ›¿æ¢é¡¹ç›®æ ¹ç›®å½•ä¸‹ pic/ æ–‡ä»¶å¤¹ä¸­çš„å¯¹åº”æ–‡ä»¶<br>
                    4. åˆ·æ–°é—®å·é¡µé¢å³å¯çœ‹åˆ°æ–°å›¾ç‰‡<br>
                    <br>
                    <strong>ğŸ¯ ä¸“ä¸šæç¤ºï¼š</strong><br>
                    â€¢ ä½¿ç”¨é«˜è´¨é‡å›¾ç‰‡ï¼Œé¿å…æ¨¡ç³Š<br>
                    â€¢ ä¿æŒä¸‰å¼ å›¾ç‰‡é£æ ¼ç»Ÿä¸€<br>
                    â€¢ é¿å…å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼ˆå»ºè®®æ¯å¼  < 500KBï¼‰
                </div>
            </div>
        </div>

        <!-- æ ·å¼è®¾ç½® -->
        <div class="tab-content" id="tab-style">
            <div class="card">
                <div class="card-title">
                    ğŸ¨ åŸºç¡€è®¾ç½®
                </div>
                <div class="form-group">
                    <label class="form-label">å“ç‰Œåç§°</label>
                    <input type="text" class="form-input" id="brandName" placeholder="ä¾‹å¦‚ï¼šé‡ç™¾çµé¤å…">
                </div>
                <div class="form-group">
                    <label class="form-label">å®Œæˆé¡µé¢æ ‡é¢˜</label>
                    <input type="text" class="form-input" id="completeTitle" placeholder="ä¾‹å¦‚ï¼šæ„Ÿè°¢æ‚¨çš„åé¦ˆï¼">
                </div>
                <div class="form-group">
                    <label class="form-label">å®Œæˆé¡µé¢æ–‡å­—</label>
                    <textarea class="form-textarea" id="completeText" placeholder="ä¾‹å¦‚ï¼šæ‚¨çš„å®è´µæ„è§å°†å¸®åŠ©æˆ‘ä»¬ä¸æ–­æ”¹è¿›"></textarea>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    ğŸŒˆ èƒŒæ™¯æ¸å˜è‰²è®¾ç½®
                </div>
                <div class="form-group">
                    <label class="form-label">èµ·å§‹é¢œè‰²</label>
                    <div class="color-picker-group">
                        <input type="color" class="color-input" id="bgColor1" value="#667eea">
                        <div class="color-preview" id="bgPreview"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ç»“æŸé¢œè‰²</label>
                    <div class="color-picker-group">
                        <input type="color" class="color-input" id="bgColor2" value="#764ba2">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¿å­˜æŒ‰é’® -->
    <div class="save-actions">
        <button class="btn btn-primary floating-btn" onclick="saveConfig()">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
        <button class="btn btn-success floating-btn" onclick="previewSurvey()">ğŸ‘ï¸ é¢„è§ˆé—®å·</button>
    </div>

    <script>
        // é»˜è®¤é…ç½®
        let config = {
            questions: [
                {
                    id: 1,
                    type: 'radio',
                    title: 'ä»Šå¤©æ‚¨å’Œè°ä¸€èµ·æ¥ç”¨é¤çš„ï¼Ÿ',
                    subtitle: '',
                    name: 'companion',
                    options: ['å®¶äºº', 'æœ‹å‹', 'å¯¹è±¡', 'ç‹¬è‡ª']
                },
                {
                    id: 2,
                    type: 'rating',
                    title: 'æ‚¨å¯¹ä»Šå¤©çš„èœå“æ»¡æ„å—ï¼Ÿ',
                    subtitle: 'ç‚¹å‡»æ˜Ÿæ˜Ÿè¿›è¡Œè¯„åˆ†',
                    name: 'rating',
                    options: []
                },
                {
                    id: 3,
                    type: 'checkbox',
                    title: 'ä»¥ä¸‹å“ªäº›å†…å®¹æ‚¨è§‰å¾—æœ‰å¾…æ”¹è¿›ï¼Ÿ',
                    subtitle: 'å¯ä»¥é€‰æ‹©å¤šä¸ªé€‰é¡¹',
                    name: 'improvements',
                    options: ['èœå“-å£å‘³', 'èœå“-åˆ†é‡', 'èœå“-ä»·æ ¼', 'æœåŠ¡', 'ç¯å¢ƒ']
                },
                {
                    id: 4,
                    type: 'text',
                    title: 'å…¶ä»–å»ºè®®',
                    subtitle: 'é€‰å¡«ï¼Œåˆ†äº«æ›´å¤šæƒ³æ³•...',
                    name: 'suggestions',
                    options: []
                }
            ],
            style: {
                brandName: 'é‡ç™¾çµé¤å…',
                bgColor1: '#667eea',
                bgColor2: '#764ba2',
                completeTitle: 'æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼',
                completeText: 'æ‚¨çš„å®è´µæ„è§å°†å¸®åŠ©æˆ‘ä»¬ä¸æ–­æ”¹è¿›ï¼Œä¸ºæ‚¨æä¾›æ›´å¥½çš„ç”¨é¤ä½“éªŒã€‚'
            }
        };

        // åŠ è½½é…ç½®
        function loadConfig() {
            const saved = localStorage.getItem('ybl_questionnaire_config');
            if (saved) {
                config = JSON.parse(saved);
            }
            renderQuestions();
            loadStyleSettings();
        }

        // æ¸²æŸ“é—®é¢˜åˆ—è¡¨
        function renderQuestions() {
            const container = document.getElementById('questionList');
            container.innerHTML = config.questions.map((q, index) => `
                <div class="question-item">
                    <div class="question-header">
                        <div class="question-title-text">
                            é—®é¢˜ ${index + 1}ï¼š${q.title}
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="question-type">${getTypeLabel(q.type)}</span>
                            <div class="question-actions">
                                <button class="btn btn-primary btn-small" onclick="editQuestion(${index})">âœï¸ ç¼–è¾‘</button>
                                <button class="btn btn-danger btn-small" onclick="deleteQuestion(${index})">ğŸ—‘ï¸ åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                    ${q.subtitle ? `<div style="color: rgba(255,255,255,0.6); font-size: 13px; margin-bottom: 10px;">${q.subtitle}</div>` : ''}
                    ${q.options.length > 0 ? `
                        <div class="option-list">
                            ${q.options.map(opt => `<span class="option-tag">${opt}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // è·å–é—®é¢˜ç±»å‹æ ‡ç­¾
        function getTypeLabel(type) {
            const labels = {
                'radio': 'å•é€‰é¢˜',
                'checkbox': 'å¤šé€‰é¢˜',
                'rating': 'æ˜Ÿçº§è¯„åˆ†',
                'text': 'æ–‡æœ¬è¾“å…¥'
            };
            return labels[type] || type;
        }

        // æ·»åŠ é—®é¢˜
        function addQuestion() {
            const title = prompt('è¯·è¾“å…¥é—®é¢˜æ ‡é¢˜ï¼š');
            if (!title) return;

            const type = prompt('è¯·é€‰æ‹©é—®é¢˜ç±»å‹ï¼š\n1. radio (å•é€‰)\n2. checkbox (å¤šé€‰)\n3. rating (æ˜Ÿçº§è¯„åˆ†)\n4. text (æ–‡æœ¬è¾“å…¥)\n\nè¯·è¾“å…¥ 1-4ï¼š');
            const types = ['radio', 'checkbox', 'rating', 'text'];
            const selectedType = types[parseInt(type) - 1];

            if (!selectedType) {
                alert('âŒ æ— æ•ˆçš„é—®é¢˜ç±»å‹');
                return;
            }

            let options = [];
            if (selectedType === 'radio' || selectedType === 'checkbox') {
                const optionsStr = prompt('è¯·è¾“å…¥é€‰é¡¹ï¼Œç”¨é€—å·åˆ†éš”ï¼ˆä¾‹å¦‚ï¼šé€‰é¡¹1,é€‰é¡¹2,é€‰é¡¹3ï¼‰ï¼š');
                if (optionsStr) {
                    options = optionsStr.split(',').map(o => o.trim()).filter(o => o);
                }
            }

            const newQuestion = {
                id: Date.now(),
                type: selectedType,
                title: title,
                subtitle: '',
                name: `question_${Date.now()}`,
                options: options
            };

            config.questions.push(newQuestion);
            renderQuestions();
        }

        // ç¼–è¾‘é—®é¢˜
        function editQuestion(index) {
            const q = config.questions[index];
            const title = prompt('ç¼–è¾‘é—®é¢˜æ ‡é¢˜ï¼š', q.title);
            if (title !== null) {
                q.title = title;
            }

            if (q.type === 'radio' || q.type === 'checkbox') {
                const optionsStr = prompt('ç¼–è¾‘é€‰é¡¹ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š', q.options.join(','));
                if (optionsStr !== null) {
                    q.options = optionsStr.split(',').map(o => o.trim()).filter(o => o);
                }
            }

            renderQuestions();
        }

        // åˆ é™¤é—®é¢˜
        function deleteQuestion(index) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤é—®é¢˜"${config.questions[index].title}"å—ï¼Ÿ`)) {
                return;
            }
            config.questions.splice(index, 1);
            renderQuestions();
        }

        // åŠ è½½æ ·å¼è®¾ç½®
        function loadStyleSettings() {
            document.getElementById('brandName').value = config.style.brandName;
            document.getElementById('bgColor1').value = config.style.bgColor1;
            document.getElementById('bgColor2').value = config.style.bgColor2;
            document.getElementById('completeTitle').value = config.style.completeTitle;
            document.getElementById('completeText').value = config.style.completeText;
            updateBgPreview();
        }

        // æ›´æ–°èƒŒæ™¯é¢„è§ˆ
        function updateBgPreview() {
            const preview = document.getElementById('bgPreview');
            const color1 = document.getElementById('bgColor1').value;
            const color2 = document.getElementById('bgColor2').value;
            preview.style.background = `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`;
        }

        // ç›‘å¬é¢œè‰²å˜åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('bgColor1')?.addEventListener('input', updateBgPreview);
            document.getElementById('bgColor2')?.addEventListener('input', updateBgPreview);
        });

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // æ›´æ–°å†…å®¹åŒºåŸŸ
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            // æ”¶é›†æ ·å¼è®¾ç½®
            config.style.brandName = document.getElementById('brandName').value;
            config.style.bgColor1 = document.getElementById('bgColor1').value;
            config.style.bgColor2 = document.getElementById('bgColor2').value;
            config.style.completeTitle = document.getElementById('completeTitle').value;
            config.style.completeText = document.getElementById('completeText').value;

            // ä¿å­˜åˆ° localStorage
            localStorage.setItem('ybl_questionnaire_config', JSON.stringify(config));

            // æç¤ºæˆåŠŸï¼ˆ0.5ç§’åè‡ªåŠ¨æ¶ˆå¤±ï¼‰
            const message = document.createElement('div');
            message.textContent = 'âœ… ä¿å­˜æˆåŠŸï¼';
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(16, 185, 129, 0.95);
                color: white;
                padding: 20px 40px;
                border-radius: 16px;
                font-size: 18px;
                font-weight: bold;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 10000;
            `;
            document.body.appendChild(message);
            setTimeout(() => message.remove(), 1500);
        }

        // é¢„è§ˆé—®å·
        function previewSurvey() {
            saveConfig();
            window.open('survey.html?preview=true', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', loadConfig);
    </script>
</body>
</html>
