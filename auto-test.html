<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è‡ªåŠ¨åŒ–æµ‹è¯• - é—¨åº—å’Œæ¡Œå·å‚æ•°</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #0f0; }
        .pass { background: #001a00; }
        .fail { background: #1a0000; color: #f00; }
        pre { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>ğŸ” è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šURLå‚æ•°è§£æ</h1>
    <div id="tests"></div>
    <hr>
    <h2>å®é™…é¡µé¢æµ‹è¯•</h2>
    <iframe id="testFrame" width="100%" height="400" style="border: 2px solid #0f0;"></iframe>

    <script>
        const results = [];

        function test(name, fn) {
            try {
                const result = fn();
                results.push({ name, pass: result.pass, message: result.message });
            } catch (e) {
                results.push({ name, pass: false, message: e.message });
            }
        }

        // æµ‹è¯•1: URLæ„é€ 
        test('äºŒç»´ç URLæ„é€ ', () => {
            const SITE_URL = 'https://a17380648227-creator.github.io/yebailing-survey';
            const storeName = 'æµ‹è¯•é—¨åº—';
            const tableName = 'A1';
            const url = `${SITE_URL}/survey.html?s=${encodeURIComponent(storeName)}&t=${encodeURIComponent(tableName)}`;

            const expected = 'https://a17380648227-creator.github.io/yebailing-survey/survey.html?s=%E6%B5%8B%E8%AF%95%E9%97%A8%E5%BA%97&t=A1';
            const pass = url === expected;

            return {
                pass,
                message: `ç”Ÿæˆçš„URL: ${url}\næœŸæœ›çš„URL: ${expected}`
            };
        });

        // æµ‹è¯•2: URLå‚æ•°è§£æï¼ˆæ¨¡æ‹Ÿï¼‰
        test('URLå‚æ•°è§£æ', () => {
            const testUrl = 'https://example.com/survey.html?s=æµ‹è¯•é—¨åº—&t=A1';
            const url = new URL(testUrl);
            const params = new URLSearchParams(url.search);

            const store = params.get('s') || 'æœªçŸ¥é—¨åº—';
            const table = params.get('t') || 'æœªçŸ¥æ¡Œå·';

            const pass = store === 'æµ‹è¯•é—¨åº—' && table === 'A1';

            return {
                pass,
                message: `è§£æç»“æœ: store="${store}", table="${table}"`
            };
        });

        // æµ‹è¯•3: æ•°æ®ä¿å­˜ç»“æ„
        test('æ•°æ®ä¿å­˜ç»“æ„', () => {
            const surveyData = {
                store: 'æµ‹è¯•é—¨åº—',
                table: 'A1',
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleString('zh-CN'),
                companion: 'å®¶äºº',
                rating: 5,
                improvements: [],
                suggestions: 'æµ‹è¯•å»ºè®®'
            };

            const hasStore = surveyData.store !== 'æœªçŸ¥é—¨åº—';
            const hasTable = surveyData.table !== 'æœªçŸ¥æ¡Œå·';
            const pass = hasStore && hasTable;

            return {
                pass,
                message: `æ•°æ®ç»“æ„: ${JSON.stringify(surveyData, null, 2)}`
            };
        });

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function displayResults() {
            const container = document.getElementById('tests');
            container.innerHTML = results.map(r => `
                <div class="test ${r.pass ? 'pass' : 'fail'}">
                    <strong>${r.pass ? 'âœ…' : 'âŒ'} ${r.name}</strong>
                    <pre>${r.message}</pre>
                </div>
            `).join('');

            const passCount = results.filter(r => r.pass).length;
            const totalCount = results.length;

            container.innerHTML += `
                <div class="test ${passCount === totalCount ? 'pass' : 'fail'}">
                    <h3>æ€»ç»“: ${passCount}/${totalCount} æµ‹è¯•é€šè¿‡</h3>
                </div>
            `;
        }

        // è¿è¡Œæµ‹è¯•
        displayResults();

        // åŠ è½½å®é™…é¡µé¢è¿›è¡Œæµ‹è¯•
        const iframe = document.getElementById('testFrame');
        iframe.src = 'https://a17380648227-creator.github.io/yebailing-survey/survey.html?s=æµ‹è¯•é—¨åº—&t=A1';

        // ç›‘å¬iframeåŠ è½½
        iframe.onload = () => {
            console.log('âœ… å®é™…é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“ é¡µé¢URL:', iframe.src);
        };
    </script>
</body>
</html>
